# ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î

## ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Header
```c
#include "mt6835.h"
#include <math.h>
#include <string.h>

static char *TAG = "MT6835";
```

- `#include "mt6835.h"` ‚Üí ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Æ‡∏î‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835 ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå
- `#include <math.h>` ‡πÅ‡∏•‡∏∞ `#include <string.h>` ‚Üí ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏≤‡∏á‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ï‡∏£‡∏¥‡∏á
- `static char *TAG = "MT6835";` ‚Üí ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° debug (‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö logging)

## ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Lookup Table ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CRC-8

```c
#if MT6835_USE_CRC == 1
static uint8_t crc8_table[256] = {
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15, 0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65, 0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    ...
};
```
- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `crc8_table[256]` ‚Üí ‡πÄ‡∏õ‡πá‡∏ô Lookup Table ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤ CRC-8 ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÇ‡∏û‡∏•‡∏¥‡πÇ‡∏ô‡πÄ‡∏°‡∏µ‡∏¢‡∏• X‚Å∏ + X¬≤ + X + 1
- `#if MT6835_USE_CRC == 1` ‚Üí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ CRC-8 ‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô `MT6835_USE_CRC`
  
```c
static uint8_t crc_table(const uint8_t *data, uint8_t len) {
    uint8_t crc = 0x00; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á CRC

    for (uint8_t i = 0; i < len; i++) {
        crc ^= data[i]; //‡∏ó‡∏≥ XOR ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ CRC ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        crc = crc8_table[crc]; // ‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á lookup table ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà
    }

    return crc;
}
```
+ ‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï:
    + `data` ‚Üí ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì CRC
    + `len` ‚Üí ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ö‡∏ï‡πå)
+   ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:
    1. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á CRC ‡πÄ‡∏õ‡πá‡∏ô 0x00
    2. ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏µ‡∏•‡∏∞‡πÑ‡∏ö‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Üí ‡∏ô‡∏≥‡∏°‡∏≤‡∏ó‡∏≥ XOR ‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ CRC ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    3. ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ XOR ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÑ‡∏õ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å crc8_table ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏°‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡πà‡∏≤ CRC ‡πÉ‡∏´‡∏°‡πà
    4. ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ ‡∏à‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡πÑ‡∏ö‡∏ï‡πå
    5. ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ CRC-8 ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CRC
```c
/**
 * @brief enable crc check
 * @param mt6835 mt6835 object
 */
void mt6835_enable_crc_check(mt6835_t *mt6835) {
    mt6835->crc_check = true;
}

/**
 * @brief disable crc check
 * @param mt6835 mt6835 object
 */
void mt6835_disable_crc_check(mt6835_t *mt6835) {
    mt6835->crc_check = false;
}
```

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
+ `mt6835_enable_crc_check(mt6835_t *mt6835)`
‚Üí ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CRC ‡πÇ‡∏î‡∏¢‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `mt6835->crc_check = true;`
+ `mt6835_disable_crc_check(mt6835_t *mt6835)`
‚Üí ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CRC ‡πÇ‡∏î‡∏¢‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `mt6835->crc_check = false;`
### ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?
‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ß‡πà‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835 ‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° SPI Chip Select (CS)
```c
/**
 * @brief spi cs control, this function is weak, you can override it
 * @param state MT6835_CS_HIGH or MT6835_CS_LOW
 */
__attribute__((weak)) void mt6835_cs_control(mt6835_cs_state_enum_t state) {
    (void)state;
}
```
### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
+ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì CS (Chip Select) ‡∏Ç‡∏≠‡∏á SPI
+ ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ `MT6835_CS_HIGH` ‡∏´‡∏£‡∏∑‡∏≠ `MT6835_CS_LOW` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á CS
+ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô `__attribute__((weak))`‡∏ã‡∏∂‡πà‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏°‡∏≤‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏Å
### ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?
‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≤ CS ‡∏Ç‡∏≠‡∏á SPI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå MT6835 ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô SPI
```c
/**
 * @brief spi send, this function is weak, you can override it
 * @param tx_buf tx buffer
 * @param len length
 */
__attribute__((weak)) void mt6835_spi_send(uint8_t *tx_buf, uint8_t len) {
    (void)tx_buf;
    (void)len;
}
```
### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
+ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835 ‡∏ú‡πà‡∏≤‡∏ô SPI
+ ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ `tx_buf` (‡∏ö‡∏±‡∏ü‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ‡πÅ‡∏•‡∏∞ `len` (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
+ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô `weak` ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏±‡∏ö‡πÑ‡∏î‡πâ
### ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?
‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835 ‡∏ú‡πà‡∏≤‡∏ô SPI

```c
/**
 * @brief spi receive, this function is weak, you can override it
 * @param rx_buf rx buffer
 * @param len length
 * @return uint8_t rx data
 */
__attribute__((weak)) void mt6835_spi_recv(uint8_t *rx_buf, uint8_t len) {
    (void)rx_buf;
    (void)len;
}
```
### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
  + ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835 ‡∏ú‡πà‡∏≤‡∏ô SPI
  + ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ `rx_buf` (‡∏ö‡∏±‡∏ü‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ‡πÅ‡∏•‡∏∞ `len` (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ö‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ö)
  + ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô `weak` ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ override ‡πÑ‡∏î‡πâ
### ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?
‡πÉ‡∏ä‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835 ‡∏ú‡πà‡∏≤‡∏ô SPI

```c
/**
 * @brief spi send and receive, this function is weak, you can override it
 * @param tx_buf tx buffer
 * @param rx_buf rx buffer
 * @param len length
 */
__attribute__((weak)) void mt6835_spi_send_recv(uint8_t *tx_buf, uint8_t *rx_buf, uint8_t len) {
    (void)tx_buf;
    (void)rx_buf;
    (void)len;
}
```
### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
+ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô ‡∏ú‡πà‡∏≤‡∏ô SPI (Full Duplex)
+ ‡πÉ‡∏ä‡πâ `tx_buf` (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á) ‡πÅ‡∏•‡∏∞ `rx_buf` (‡∏ö‡∏±‡∏ü‡πÄ‡∏ü‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≤)
+ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô `weak` ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ override ‡πÑ‡∏î‡πâ
### ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?
‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835 ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô SPI

---
---

##  ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå mt6835_create()
```c
/**
 * @brief create a mt6835 object
 * @return mt6835 object
 */
mt6835_t *mt6835_create() {
    mt6835_t *mt6835 = (mt6835_t *)MT6835_MALLOC(sizeof(mt6835_t));
    if (mt6835 == NULL) {
        MT6835_DEBUG("%s malloc failed", TAG);
        return NULL;
    }
    memset(mt6835, 0, sizeof(mt6835_t));
    mt6835->crc_check = false;
    return mt6835;
}
```
### ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
#### 1.‡∏Ç‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå `mt6835_t`
```c
mt6835_t *mt6835 = (mt6835_t *)MT6835_MALLOC(sizeof(mt6835_t));
```
+ ‡πÉ‡∏ä‡πâ `MT6835_MALLOC(sizeof(mt6835_t))` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÅ‡∏ö‡∏ö dynamic
+ `mt6835_t *` ‡∏Ñ‡∏∑‡∏≠‡∏û‡∏≠‡∏¢‡∏ô‡πå‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô
+ `MT6835_MALLOC` ‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô macro ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏õ‡πá‡∏ô `malloc()`‡∏´‡∏£‡∏∑‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô
#### 2.‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `malloc` ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
```c
if (mt6835 == NULL) {
    MT6835_DEBUG("%s malloc failed", TAG);
    return NULL;
}
```
+ ‡∏´‡∏≤‡∏Å `malloc()` ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÑ‡∏°‡πà‡∏û‡∏≠) ‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ `NULL`

#### 3.‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏Ç‡∏≠‡∏á `mt6835`
```c
memset(mt6835, 0, sizeof(mt6835_t));
```
‡πÉ‡∏ä‡πâ `memset()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÑ‡∏ö‡∏ï‡πå‡πÄ‡∏õ‡πá‡∏ô `0`
‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡∏¢‡∏∞‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤

#### 4.‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ `crc_check` ‡πÄ‡∏õ‡πá‡∏ô `false`
```c
mt6835->crc_check = false;
```
+ ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `crc_check` ‡πÄ‡∏õ‡πá‡∏ô `false` (‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CRC)

#### 5.‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå `mt6835_t *` ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô

```c
return mt6835;
```

##  ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå mt6835_destroy()
```c
/**
 * @brief destroy a mt6835 object
 * @param mt6835 mt6835 object
 */
void mt6835_destroy(mt6835_t *mt6835) {
    if (mt6835 != NULL) {
        MT6835_FREE(mt6835);
    }
}
```

### ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
#### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏û‡∏≠‡∏¢‡∏ô‡πå‡πÄ‡∏ï‡∏≠‡∏£‡πå `mt6835` ‡πÄ‡∏õ‡πá‡∏ô `NULL` ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
```c
if (mt6835 != NULL) {
```
+ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏´‡∏≤‡∏Å‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏Ç‡∏≠‡∏á `NULL` pointer`
+ ‡∏ñ‡πâ‡∏≤ `mt6835` ‡πÄ‡∏õ‡πá‡∏ô `NULL` ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢

#### 2.‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
```c
MT6835_FREE(mt6835);
```
+ `MT6835_FREE()` ‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô macro ‡∏Ç‡∏≠‡∏á `free()`
+ ‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏à‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡∏ï‡∏≠‡∏ô `mt6835_create()`
+ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô memory leak

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° SPI Chip Select (CS)
```c
void mt6835_link_spi_cs_control(mt6835_t *mt6835, void (*spi_cs_control)(mt6835_cs_state_enum_t state)) {
    if (mt6835 == NULL) {
        MT6835_DEBUG("%s mt6835 object is null", TAG);
        return;
    }
    if (spi_cs_control == NULL) {
        MT6835_DEBUG("%s mt6835 object use default spi_cs_control(null)", TAG);
        mt6835->func.spi_cs_control = mt6835_cs_control;
    } else {
        mt6835->func.spi_cs_control = spi_cs_control;
    }
}
```

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
#### 1.‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå `mt6835` ‡πÄ‡∏õ‡πá‡∏ô `NULL` ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
```c
if (mt6835 == NULL) {
    MT6835_DEBUG("%s mt6835 object is null", TAG);
    return;
}
```
+ ‡∏ñ‡πâ‡∏≤ `mt6835` ‡πÄ‡∏õ‡πá‡∏ô `NULL` ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô -> ‡πÅ‡∏™‡∏î‡∏á debug log ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô

#### 2.‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `spi_cs_control` ‡πÄ‡∏õ‡πá‡∏ô `NULL` ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
```c
if (spi_cs_control == NULL) {
    MT6835_DEBUG("%s mt6835 object use default spi_cs_control(null)", TAG);
    mt6835->func.spi_cs_control = mt6835_cs_control;
} else {
    mt6835->func.spi_cs_control = spi_cs_control;
}
```
+ ‡∏ñ‡πâ‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå `spi_cs_control` ‡πÄ‡∏õ‡πá‡∏ô `NULL` ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô `mt6835_cs_control`
+ ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏°‡∏≤‡πÄ‡∏≠‡∏á (`spi_cs_control` ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô `NULL`) ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SPI
```c
void mt6835_link_spi_send(mt6835_t *mt6835, void (*spi_send)(uint8_t *tx_buf, uint8_t len)) {
    if (mt6835 == NULL) {
        MT6835_DEBUG("%s mt6835 object is null", TAG);
        return;
    }
    if (spi_send == NULL) {
        MT6835_DEBUG("%s mt6835 object use default spi_send(null)", TAG);
        mt6835->func.spi_send = mt6835_spi_send;
    }
    mt6835->func.spi_send = spi_send;
}
```

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ `mt6835` ‡πÄ‡∏õ‡πá‡∏ô `NULL` -> ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô `NULL` ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á debug log ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
2. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ `spi_send` ‡πÄ‡∏õ‡πá‡∏ô `NULL`
   + ‡∏ñ‡πâ‡∏≤ `NULL` -> ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô `mt6835_spi_send`

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SPI
```c
void mt6835_link_spi_recv(mt6835_t *mt6835, void (*spi_recv)(uint8_t *rx_buf, uint8_t len)) {
    if (mt6835 == NULL) {
        MT6835_DEBUG("%s mt6835 object is null", TAG);
        return;
    }
    if (spi_recv == NULL) {
        MT6835_DEBUG("%s mt6835 object use default spi_recv(null)", TAG);
        mt6835->func.spi_recv = mt6835_spi_recv;
    }
    mt6835->func.spi_recv = spi_recv;
}
```
### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
+ ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö `mt6835_link_spi_send()`

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SPI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
```c
void mt6835_link_spi_send_recv(mt6835_t *mt6835, void (*spi_send_recv)(uint8_t *tx_buf, uint8_t *rx_buf, uint8_t len)) {
    if (mt6835 == NULL) {
        MT6835_DEBUG("%s mt6835 object is null", TAG);
        return;
    }
    if (spi_send_recv == NULL) {
        MT6835_DEBUG("%s mt6835 object use default spi_send_recv(null)", TAG);
        mt6835->func.spi_send_recv = mt6835_spi_send_recv;
    }
    mt6835->func.spi_send_recv = spi_send_recv;
}
```
### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
+ ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_link_spi_send()` ‡πÅ‡∏•‡∏∞ `mt6835_link_spi_recv()`

##  ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå: mt6835_read_reg()
```c
uint8_t mt6835_read_reg(mt6835_t *mt6835, mt6835_reg_enum_t reg) {
    uint8_t result[3] = {0, 0, 0};

    /* data frame */
    mt6835->func.spi_cs_control(MT6835_CS_HIGH);
    mt6835->data_frame.cmd = MT6835_CMD_RD; // byte read command
    mt6835->data_frame.reg = reg;

    mt6835->func.spi_cs_control(MT6835_CS_LOW);
    if (mt6835->func.spi_send_recv == NULL ? false : true) {
        mt6835->func.spi_send_recv((uint8_t *)&mt6835->data_frame.pack, (uint8_t *)&result, 3);
    } else {
        mt6835->func.spi_send((uint8_t *)&mt6835->data_frame.pack, 3);
        mt6835->func.spi_recv((uint8_t *)&result, 3);
    }
    mt6835->func.spi_cs_control(MT6835_CS_HIGH);

    return result[2];
}
```
### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
#### 1.‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `result[3]`
```c
uint8_t result[3] = {0, 0, 0};
```
+ ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å SPI (3 ‡πÑ‡∏ö‡∏ï‡πå)

#### 2.‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏≠‡πà‡∏≤‡∏ô (`MT6835_CMD_RD`) ‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô
```c
mt6835->data_frame.cmd = MT6835_CMD_RD; // byte read command
mt6835->data_frame.reg = reg;
```
+ `cmd = MT6835_CMD_RD` ‚Üí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á "‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
+ `reg = reg` ‚Üí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô

#### 3.‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô SPI Communication
```c
mt6835->func.spi_cs_control(MT6835_CS_LOW);
```
‡∏î‡∏∂‡∏á **Chip Select (CS)** ‡∏ï‡πà‡∏≥ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SPI

#### 4.‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `spi_send_recv()` ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
```c
if (mt6835->func.spi_send_recv == NULL ? false : true) {
    mt6835->func.spi_send_recv((uint8_t *)&mt6835->data_frame.pack, (uint8_t *)&result, 3);
} else {
    mt6835->func.spi_send((uint8_t *)&mt6835->data_frame.pack, 3);
    mt6835->func.spi_recv((uint8_t *)&result, 3);
}
```
+ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `spi_send_recv()` ‚Üí ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô)
+ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‚Üí ‡πÉ‡∏ä‡πâ `spi_send()` ‡πÅ‡∏•‡∏∞ `spi_recv()` ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô

#### 5.‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ SPI
```c
mt6835->func.spi_cs_control(MT6835_CS_HIGH);
```
+ ‡∏õ‡∏£‡∏±‡∏ö Chip Select (CS) ‡∏™‡∏π‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£

#### 6.‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå
```c
return result[2];
```
+ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà ‡πÑ‡∏ö‡∏ï‡πå‡∏ó‡∏µ‡πà 2 (result[2])
+ ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ö‡∏ï‡πå‡πÅ‡∏£‡∏Å (result[0]) ‡πÅ‡∏•‡∏∞‡πÑ‡∏ö‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á (result[1]) ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CRC ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå: mt6835_write_reg()
```c
void mt6835_write_reg(mt6835_t *mt6835, mt6835_reg_enum_t reg, uint8_t data) {
    uint8_t result[3] = {0, 0, 0};

    mt6835->func.spi_cs_control(MT6835_CS_HIGH);
    mt6835->data_frame.cmd = MT6835_CMD_WR; // byte write command
    mt6835->data_frame.reg = reg;
    mt6835->data_frame.normal_byte = data;

    mt6835->func.spi_cs_control(MT6835_CS_LOW);
    mt6835->func.spi_send_recv((uint8_t *)&mt6835->data_frame.pack, (uint8_t *)&result, 3);
    mt6835->func.spi_cs_control(MT6835_CS_HIGH);
}
```

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
#### 1.‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `result[3]`
```c
uint8_t result[3] = {0, 0, 0};
```
+ ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å MT6835
#### 2.‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô (`MT6835_CMD_WR`) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô
```c
mt6835->data_frame.cmd = MT6835_CMD_WR; // byte write command
mt6835->data_frame.reg = reg;
mt6835->data_frame.normal_byte = data;
```
+ `cmd = MT6835_CMD_WR` ‚Üí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
+ `reg = reg` ‚Üí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô
+ `normal_byte = data` ‚Üí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏•‡∏á‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå

#### 3.‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô SPI Communication
```c
mt6835->func.spi_cs_control(MT6835_CS_LOW);
```
+ ‡∏î‡∏∂‡∏á Chip Select (CS) ‡∏ï‡πà‡∏≥ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SPI

#### 4.‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á MT6835
```c
mt6835->func.spi_send_recv((uint8_t *)&mt6835->data_frame.pack, (uint8_t *)&result, 3);
```
+ ‡πÉ‡∏ä‡πâ `spi_send_recv()` ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå
+ `result[]` ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å MT6835

#### 5.‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ SPI
```c
mt6835->func.spi_cs_control(MT6835_CS_HIGH);
```
+ ‡∏õ‡∏£‡∏±‡∏ö Chip Select (CS) ‡∏™‡∏π‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_write_eeprom()`
```c
/**
 * @brief write mt6835 eeprom, you must to write corresponding register first, and then call this function.
 * you need wait 6 seconds after write eeprom
 * @param mt6835 mt6835 object
 * @return true if success, false otherwise
 */
bool mt6835_write_eeprom(mt6835_t *mt6835) {
    uint8_t result[3] = {0, 0, 0xFF};

    mt6835->func.spi_cs_control(MT6835_CS_HIGH);
    mt6835->data_frame.cmd = MT6835_CMD_EEPROM; // byte read command
    mt6835->data_frame.reg = 0;
    mt6835->data_frame.normal_byte = 0;

    mt6835->func.spi_cs_control(MT6835_CS_LOW);
    mt6835->func.spi_send_recv((uint8_t *)&mt6835->data_frame.pack, (uint8_t *)&result, 3);
    mt6835->func.spi_cs_control(MT6835_CS_HIGH);

    if (result[2] == 0xFF || result[2] != 0x55) {
        return false;
    }
    return true;
}
```
#### 1.‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `uint8_t result[3]`
```c
bool mt6835_write_eeprom(mt6835_t *mt6835) {
    uint8_t result[3] = {0, 0, 0xFF};
```
+  ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `result[3]` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å SPI
    + `result[0] = 0` ‚Üí ‡πÑ‡∏ö‡∏ï‡πå‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
    + `result[1] = 0` ‚Üí ‡πÑ‡∏ö‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
    + `result[2] = 0xFF` ‚Üí ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡∏µ‡∏ü‡∏≠‡∏•‡∏ï‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô `0xFF` ‡∏ã‡∏∂‡πà‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏°‡∏≤

---
```c
 mt6835->func.spi_cs_control(MT6835_CS_HIGH);
```
+ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Chip Select (CS) ‡πÄ‡∏õ‡πá‡∏ô HIGH ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ SPI ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
```c
 mt6835->data_frame.cmd = MT6835_CMD_EEPROM; // byte read command
    mt6835->data_frame.reg = 0;
    mt6835->data_frame.normal_byte = 0;
```
+ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (`cmd`)
    + `MT6835_CMD_EEPROM` ‚Üí ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô EEPROM
+ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0
    + `reg = 0` ‚Üí ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå
    + `normal_byte = 0` ‚Üí ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

```c
mt6835->func.spi_cs_control(MT6835_CS_LOW);
```
+ ‡∏î‡∏∂‡∏á CS ‡∏•‡∏á‡∏ï‡πà‡∏≥ (CS_LOW) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô SPI

```c
    mt6835->func.spi_send_recv((uint8_t *)&mt6835->data_frame.pack, (uint8_t *)&result, 3);
```
+ ‡πÉ‡∏ä‡πâ SPI ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
+ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô 3 ‡πÑ‡∏ö‡∏ï‡πå
+ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `result[]`

```c
    mt6835->func.spi_cs_control(MT6835_CS_HIGH);
```
+ ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ SPI ‡πÇ‡∏î‡∏¢‡∏î‡∏∂‡∏á CS ‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏π‡∏á (`CS_HIGH`)

```c
    if (result[2] == 0xFF || result[2] != 0x55) {
        return false;
    }
```

+ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö (`result[2]`)
    + ‡∏ñ‡πâ‡∏≤ result[2] == 0xFF ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î)
    + ‡∏ñ‡πâ‡∏≤ result[2] != 0x55 ‚Üí EEPROM ‡πÑ‡∏°‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î)
    + ‡∏ñ‡πâ‡∏≤‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ false
  
```c
     return true;
}
```
+ ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠ `0x55` ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô EEPROM ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Üí ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ `true`


## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_get_id()`
```c
uint8_t mt6835_get_id(mt6835_t *mt6835) {
    return mt6835_read_reg(mt6835, MT6835_REG_ID);
}
```

1. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `mt6835_read_reg(mt6835, MT6835_REG_ID)`
+ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_read_reg()` ‡∏à‡∏∞‡πÉ‡∏ä‡πâ SPI ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå `MT6835_REG_ID`
2. ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ (‡∏Ñ‡πà‡∏≤ ID ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå) ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô `uint8_t`

##  ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_set_id()`
```c
void mt6835_set_id(mt6835_t *mt6835, uint8_t custom_id) {
    mt6835_write_reg(mt6835, MT6835_REG_ID, custom_id);
}
```
1. ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ `custom_id` ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå (‡∏Ñ‡πà‡∏≤ ID ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á)
2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `mt6835_write_reg(mt6835, MT6835_REG_ID, custom_id)`
+ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_write_reg()` ‡∏à‡∏∞‡πÉ‡∏ä‡πâ SPI ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå `MT6835_REG_ID`
3. ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô ID ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå

##  ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_get_raw_zero_angle()`
```c
uint16_t mt6835_get_raw_zero_angle(mt6835_t *mt6835) {
    uint8_t rx_buf[2] = {0};
    rx_buf[1] = mt6835_read_reg(mt6835, MT6835_REG_ZERO2);
    rx_buf[0] = mt6835_read_reg(mt6835, MT6835_REG_ZERO1);
    uint16_t res = (rx_buf[1] << 4) | (rx_buf[0] >> 4);
    return res;
}
```
### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
1. ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® `rx_buf[2]` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á MT6835
2. ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå `MT6835_REG_ZERO2` ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà `rx_buf[1]`
3. ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå `MT6835_REG_ZERO1` ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà `rx_buf[0]`
4. ‡∏ô‡∏≥‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å `rx_buf[1]` ‡πÅ‡∏•‡∏∞ `rx_buf[0]` ‡∏°‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ Zero Angle (raw)
+ ‡πÉ‡∏ä‡πâ‡∏ö‡∏¥‡∏ï‡∏ä‡∏¥‡∏ü‡∏ï‡πå `(rx_buf[1] << 4) | (rx_buf[0] >> 4)` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ 12-bit
5. ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô `uint16_t` ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ Zero Angle ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏î‡∏¥‡∏ö (Raw Data)
###  ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå (12-bit Zero Angle)
+ `MT6835_REG_ZERO1` ‡πÄ‡∏Å‡πá‡∏ö 8-bit ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î
+ `MT6835_REG_ZERO2` ‡πÄ‡∏Å‡πá‡∏ö 4-bit ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
‡∏Ñ‡πà‡∏≤‡∏î‡∏¥‡∏ö‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô 12-bit ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ

```c
(rx_buf[1] << 4) | (rx_buf[0] >> 4)
```
+ `rx_buf[1] << 4` ‚Üí ‡∏Ç‡∏¢‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ `ZERO2` ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ 4 ‡∏ö‡∏¥‡∏ï
+ `rx_buf[0] >> 4` ‚Üí ‡∏î‡∏∂‡∏á 4 ‡∏ö‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å `ZERO1`
+ ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ 12-bit

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_get_zero_angle()`
```c
float mt6835_get_zero_angle(mt6835_t *mt6835) {
    return (float)mt6835_get_raw_zero_angle(mt6835) * MT6835_ZERO_REG_STEP;
}
```

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
1. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `mt6835_get_raw_zero_angle()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ Zero Angle (raw)
2. ‡∏Ñ‡∏π‡∏ì‡∏Ñ‡πà‡∏≤‡∏î‡∏¥‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà `MT6835_ZERO_REG_STEP` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏≠‡∏á‡∏®‡∏≤ (degree)
3. ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô `float` ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏°‡∏∏‡∏° Zero Angle ‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏≠‡∏á‡∏®‡∏≤
### `MT6835_ZERO_REG_STEP` ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
+ ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤ Raw Data (12-bit) ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ **‡∏≠‡∏á‡∏®‡∏≤**
+ ‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß Zero Angle ‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î 12-bit (0 ‡∏ñ‡∏∂‡∏á 4095) ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏ó‡∏ô‡∏°‡∏∏‡∏° 0¬∞ ‡∏ñ‡∏∂‡∏á 360¬∞
‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô
```c
MT6835_ZERO_REG_STEP = 360.0 / 4096.0 = 0.087890625
```
+ ‡∏ã‡∏∂‡πà‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤ 1 unit ‡∏Ç‡∏≠‡∏á Raw Data = 0.08789¬∞

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_set_zero_angle()`

```c
bool mt6835_set_zero_angle(mt6835_t *mt6835, float rad) {
    uint16_t angle = (uint16_t)roundf(rad * 57.295779513f / MT6835_ZERO_REG_STEP);
    if (angle > 0xFFF) {
        return false;
    }

    uint8_t tx_buf[2] = {0};

    tx_buf[1] = angle >> 4;
    tx_buf[0] = (angle & 0x0F) << 4;
    tx_buf[0] |= mt6835_read_reg(mt6835, MT6835_REG_ZERO1) & 0x0F;

    mt6835_write_reg(mt6835, MT6835_REG_ZERO2, tx_buf[1]);
    mt6835_write_reg(mt6835, MT6835_REG_ZERO1, tx_buf[0]);

    return true;
}
```

####  1.‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö (12-bit)
```c
uint16_t angle = (uint16_t)roundf(rad * 57.295779513f / MT6835_ZERO_REG_STEP);
```

+ `rad * 57.295779513f` ‚Üí ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏á‡∏®‡∏≤
+ ‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢ `MT6835_ZERO_REG_STEP` ‚Üí ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå
+ `roundf(...)` ‚Üí ‡∏õ‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°
+ ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô `uint16_t` (12-bit)

####  2.‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö (0 - 4095)
```c
if (angle > 0xFFF) {
    return false;
}
```
+  ‡∏Ñ‡πà‡∏≤ Zero Angle ‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 12-bit (0 - 0xFFF ‡∏´‡∏£‡∏∑‡∏≠ 0 - 4095)
+   ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ ‡πÄ‡∏Å‡∏¥‡∏ô 4095 ‚Üí ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (return false)

#### 3.‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏•‡∏á‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå
```c
uint8_t tx_buf[2] = {0};
tx_buf[1] = angle >> 4;
tx_buf[0] = (angle & 0x0F) << 4;
tx_buf[0] |= mt6835_read_reg(mt6835, MT6835_REG_ZERO1) & 0x0F;
```
#### üìå ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤ Zero Angle (12-bit)
+ Zero Angle ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô 12-bit (2 ‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå)
    + MT6835_REG_ZERO1 ‚Üí ‡πÄ‡∏Å‡πá‡∏ö 8-bit ‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 4-bit ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)
    + MT6835_REG_ZERO2 ‚Üí ‡πÄ‡∏Å‡πá‡∏ö 4-bit ‡∏ö‡∏ô‡∏™‡∏∏‡∏î
+ ‡πÉ‡∏ä‡πâ Bitwise Operations ‡πÅ‡∏¢‡∏Å‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å `angle` ‡πÄ‡∏õ‡πá‡∏ô 2-byte
    + `tx_buf[1] = angle >> 4;` ‚Üí ‡∏î‡∏∂‡∏á 4-bit ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `tx_buf[1]`
    + `tx_buf[0] = (angle & 0x0F) << 4;` ‚Üí ‡∏î‡∏∂‡∏á 4-bit ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `tx_buf[0]`
    + `tx_buf[0] |= mt6835_read_reg(mt6835, MT6835_REG_ZERO1) & 0x0F;` ‚Üí ‡∏£‡∏±‡∏Å‡∏©‡∏≤ 4-bit ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå `ZERO1 `‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏¥‡∏°

#### 4. ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏•‡∏á‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå
```c
mt6835_write_reg(mt6835, MT6835_REG_ZERO2, tx_buf[1]);
mt6835_write_reg(mt6835, MT6835_REG_ZERO1, tx_buf[0]);
```

+ ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå
  + `MT6835_REG_ZERO2` ‚Üí ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô 4-bit ‡∏ö‡∏ô
  + `MT6835_REG_ZERO1` ‚Üí ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô 4-bit ‡∏•‡πà‡∏≤‡∏á + 4-bit ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏°‡∏≤

#### 5.‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
```c
return true;
```
+  ‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ `true`


---
```c

/**
 * @brief get mt6835 raw angle
 * @param mt6835 mt6835 object
 * @param method read angle method, MT6835_READ_ANGLE_METHOD_NORMAL or MT6835_READ_ANGLE_METHOD_BURST
 * @return raw angle data in raw
 */
uint32_t mt6835_get_raw_angle(mt6835_t *mt6835, mt6835_read_angle_method_enum_t method) {
    uint8_t rx_buf[6] = {0};
    uint8_t tx_buf[6] = {0};

    switch (method) {
        case MT6835_READ_ANGLE_METHOD_NORMAL: {
            rx_buf[0] = mt6835_read_reg(mt6835, MT6835_REG_ANGLE3);
            rx_buf[1] = mt6835_read_reg(mt6835, MT6835_REG_ANGLE2);
            rx_buf[2] = mt6835_read_reg(mt6835, MT6835_REG_ANGLE1);
            if (mt6835->crc_check) {
                rx_buf[3] = mt6835_read_reg(mt6835, MT6835_REG_CRC);
            }
            break;
        }
        case MT6835_READ_ANGLE_METHOD_BURST: {
            const uint8_t rd = mt6835->crc_check ? 6 : 5;

            mt6835->func.spi_cs_control(MT6835_CS_HIGH);
            mt6835->data_frame.cmd = MT6835_CMD_BURST;
            mt6835->data_frame.reg = MT6835_REG_ANGLE3;
            tx_buf[0] = mt6835->data_frame.pack & 0xFF;
            tx_buf[1] = (mt6835->data_frame.pack >> 8) & 0xFF;

            mt6835->func.spi_cs_control(MT6835_CS_LOW);
            if (mt6835->func.spi_send_recv) {
                mt6835->func.spi_send_recv(tx_buf, rx_buf, rd);
            } else {
                mt6835->func.spi_send(tx_buf, rd);
                mt6835->func.spi_recv(rx_buf, rd);
            }
            mt6835->func.spi_cs_control(MT6835_CS_HIGH);

            memmove(rx_buf, &rx_buf[2], 3);
            if (mt6835->crc_check) {
                rx_buf[3] = rx_buf[5];
            }
            break;
        }
    }

    if (mt6835->crc_check) {
        mt6835->crc = rx_buf[3];
#if MT6835_USE_CRC == 1
        if (crc_table(rx_buf, 3) != rx_buf[3]) {
            MT6835_DEBUG("%s crc check failed\r\n", TAG);
            mt6835->crc_res = false;
            return 0;
        }
        mt6835->crc_res = true;
#endif
    }

    mt6835->state = rx_buf[2] & 0x07;
    return (rx_buf[0] << 13) | (rx_buf[1] << 5) | (rx_buf[2] >> 3);
}


/**
 * @brief get mt6835 angle in rad
 * @param mt6835 mt6835 object
 * @param method read angle method, MT6835_READ_ANGLE_METHOD_NORMAL or MT6835_READ_ANGLE_METHOD_BURST
 * @return angle data in rad
 */
float mt6835_get_angle(mt6835_t *mt6835, mt6835_read_angle_method_enum_t method) {
    uint32_t raw_angle = mt6835_get_raw_angle(mt6835, method);
    return (float)(raw_angle * 2.996056226329803e-6);
}

```

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_get_raw_angle`
‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏∏‡∏°‡∏î‡∏¥‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835 ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏≠‡∏á‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏∑‡∏≠ ‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞ ‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏™‡∏ï‡πå ‡∏ô‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CRC ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå
‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏°‡∏∏‡∏° (raw angle) ‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835 ‡πÇ‡∏î‡∏¢‡∏°‡∏µ 2 ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏°‡∏∏‡∏° ‡∏Ñ‡∏∑‡∏≠:

+ **MT6835_READ_ANGLE_METHOD_NORMAL**: ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏°‡∏∏‡∏°‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡πÜ
+ **MT6835_READ_ANGLE_METHOD_BURST**: ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏°‡∏∏‡∏°‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö burst (‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô mt6835_get_raw_angle()
### ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
#### 1.‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:
+ `mt6835`: ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835
+ `method`: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏°‡∏∏‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á `MT6835_READ_ANGLE_METHOD_NORMAL` ‡∏´‡∏£‡∏∑‡∏≠ `MT6835_READ_ANGLE_METHOD_BURST`)

#### 2.‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:
+ **‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Normal:**
    + ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ raw angle ‡∏à‡∏≤‡∏Å‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå `MT6835_REG_ANGLE3`, `MT6835_REG_ANGLE2`, ‡πÅ‡∏•‡∏∞ `MT6835_REG_ANGLE1` ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_read_reg()`
    + ‡∏ñ‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CRC ‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `mt6835->crc_check`), ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ CRC ‡∏à‡∏≤‡∏Å‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå `MT6835_REG_CRC`
+ **‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Burst:**
  + ‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£ Burst, ‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Burst ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  + ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `MT6835_CMD_BURST` ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô `mt6835->data_frame.cmd`
  + ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ SPI ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô `rx_buf`
  + ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (memmove) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏∏‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
#### 3.‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CRC:

+ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CRC (`mt6835->crc_check`), ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CRC ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
+ ‡∏´‡∏≤‡∏Å CRC ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á, ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤ crc check failed
+ ‡∏ñ‡πâ‡∏≤ CRC ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á, ‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤ CRC ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÉ‡∏ô `mt6835->crc` ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `mt6835->crc_res` ‡πÄ‡∏õ‡πá‡∏ô `true`
#### 4.‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°:

+ ‡∏Ñ‡πà‡∏≤‡∏°‡∏∏‡∏° raw ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏£‡∏µ‡∏à‡∏¥‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô `rx_buf`
+ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `rx_buf[0]`, `rx_buf[1]`, ‡πÅ‡∏•‡∏∞ `rx_buf[2]` ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏°‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ raw angle ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô 32-bit ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£ shift ‡∏ö‡∏¥‡∏ï:
```c
return (rx_buf[0] << 13) | (rx_buf[1] << 5) | (rx_buf[2] >> 3);
```
+ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (state) ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô `mt6835->state` ‡πÇ‡∏î‡∏¢‡πÄ‡∏Å‡πá‡∏ö 3 ‡∏ö‡∏¥‡∏ï‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å` rx_buf[2]`

## ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `mt6835_get_angle()`
‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• raw angle ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å mt6835_get_raw_angle() ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏∏‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ radian.

### ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
#### 1.‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:
+ `mt6835`: ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå MT6835
+ `method`: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏°‡∏∏‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå (`MT6835_READ_ANGLE_METHOD_NORMAL` ‡∏´‡∏£‡∏∑‡∏≠ `MT6835_READ_ANGLE_METHOD_BURST`)
#### 2.‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤ raw angle:

+ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `mt6835_get_raw_angle()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• raw angle ‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå
‡∏Ñ‡πà‡∏≤ raw angle ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∏‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ radian ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì:
```c
(float)(raw_angle * 2.996056226329803e-6)
```
‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏°‡∏∏‡∏°‡∏à‡∏≤‡∏Å raw data (‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏©) ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∏‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ radian ‡πÇ‡∏î‡∏¢‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì 2.`996056226329803e-6 `‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤ raw angle ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∏‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ radian
